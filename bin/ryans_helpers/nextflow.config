// Nextflow configuration for HAN pipeline on Slurm
profiles {
    slurm {
        process {
            executor = 'slurm'
            queue = 'savio3_gpu'
            clusterOptions = '--account=co_nilah --qos=savio_lowprio'
            
            // Default process configuration
            cpus = 8
            time = '12h'
            
            // Process-specific configurations
            withName: train_model {
                clusterOptions = '--account=co_nilah --qos=savio_lowprio --gres=gpu:1'
                time = '24h'
            }
            
            withName: evaluate_model {
                clusterOptions = '--account=co_nilah --qos=savio_lowprio --gres=gpu:1'
                time = '12h'
            }
            
            withName: generate_plots {
                time = '1h'
            }
            
            withName: generate_report {
                time = '1h'
            }
        }
        
        // Enable job resubmission on failure
        process.errorStrategy = 'retry'
        process.maxRetries = 3
        
        // Cleanup work directory after successful completion
        cleanup = true
    }
}

// Manifest
manifest {
    name = 'HAN Pipeline'
    author = 'Ryan Keivanfar'
    description = 'Pipeline for training and evaluating HAN model on genomic sequences'
    version = '1.0.0'
}

// Timeline and performance reports
timeline {
    enabled = true
    overwrite = true
}

report {
    enabled = true
    overwrite = true
}

trace {
    enabled = true
    overwrite = true
}

// Work directory will be set by params.output_base in the run script
workDir = "${params.output_base}/work"
