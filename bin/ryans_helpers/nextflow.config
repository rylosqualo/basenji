// Nextflow configuration for HAN pipeline on Slurm
profiles {
    slurm {
        process {
            executor = 'slurm'
            queue = 'savio3_gpu'
            clusterOptions = '--account=co_nilah --qos=savio_lowprio'
            
            // Default process configuration
            cpus = 8
            memory = '32 GB'
            time = '12h'
            
            // Process-specific configurations
            withName: train_model {
                clusterOptions = '--account=co_nilah --qos=savio_lowprio --gres=gpu:1'
                time = '24h'
                memory = '64 GB'
            }
            
            withName: evaluate_model {
                clusterOptions = '--account=co_nilah --qos=savio_lowprio --gres=gpu:1'
                time = '12h'
                memory = '32 GB'
            }
            
            withName: generate_plots {
                time = '1h'
                memory = '16 GB'
            }
            
            withName: generate_report {
                time = '1h'
                memory = '16 GB'
            }
        }
        
        // Enable job resubmission on failure
        process.errorStrategy = 'retry'
        process.maxRetries = 3
        
        // Cleanup work directory after successful completion
        cleanup = true
    }
}

// Manifest
manifest {
    name = 'HAN Pipeline'
    author = 'Ryan Keivanfar'
    description = 'Pipeline for training and evaluating HAN model on genomic sequences'
    version = '1.0.0'
}

// Timeline and performance reports
timeline {
    enabled = true
    file = "${params.output_base}/pipeline_info/timeline.html"
}

report {
    enabled = true
    file = "${params.output_base}/pipeline_info/report.html"
}

trace {
    enabled = true
    file = "${params.output_base}/pipeline_info/trace.txt"
}

// Ensure work directory is on scratch space
workDir = "/global/scratch/users/$USER/nextflow_work"
} 